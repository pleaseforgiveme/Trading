// File: earnings-calendar-alerts.js
!function(a,b,c,d){function e(a,b){c.ajax({url:"/useralerts/service/getInstrumentData",data:{pair_ID:a.pairId},type:"post",dataType:"json"}).done(function(a){a.avg_volume&&(a.volume=a.avg_volume),a.last&&(a.value=a.last),b(a)})}function f(a){k.popup.appendTo(a.$el,!0),k.form.setDefaultParams(a.data),k.popup.show(),j=a}function g(a){var b=this;return k.popup.getEl().is(a.target)||k.popup.getEl().find(a.target).length?!0:k.popup.isShown()&&j===b?(k.popup.hide(),void(j=null)):void(b.hasData?f(b):e(b.data,function(a){c.extend(b.data,a),f(b),b.hasData=!0}))}function h(){i&&i.unbind("click"),i=b.find(".js-injected-user-alert-container"),i.each(function(a){var b=i.eq(a),c={data:{pairId:b.attr("data-pair-id"),alert_trigger:"Earnings"},$el:b};b.bind("click",g.bind(c))})}var i,j=null,k={},l={red:"redFont",green:"greenFont",black:""};loader(["instrumentPopupParams","userAlertsPopupParams",{type:"$",value:".js-user-alert-popup"}]).ready(function(b,d,e){if(b.globals){var f=c.extend({useGeneralOverlay:!1},b.globals);k.texts=f.texts,k.rowTexts=f.rowTexts,k.popup=new UserAlertsPopup(e,f),k.form=new InstrumentUserAlerts(null,null,k.texts,k.popup,{disableRemove:!1}),k.form.subscribe(function(){k.form.showSuccessMessage(),j.$el.addClass("hasAlert"),j=null}),h(),calendarFilters.on("update",h),c(a).on("EarningsCal",function(a,b){var d,e=l[b.color],f=".pid-"+b.pair_ID;delete b.color,delete b.pair_ID;for(d in b)c(f+"-"+d).text(b[d]).removeClass("redFont greenFont bold").addClass("bold "+(e||""))})}})}(window,$(document),jQuery,window.components);